namespace SpriteKind {
    export const Critter = SpriteKind.create()
}
type Critter = {
    name: string
    sprite: Sprite
    location: Array<number>
    happiness: number
    health: number
}

let happinessFactor = 0
scene.setBackgroundColor(6)
scene.setBackgroundImage(img`
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    `)
tiles.setTilemap(tilemap`farm`)
let ginny = sprites.create(assets.image`ginny`, SpriteKind.Player)
controller.moveSprite(ginny, 60, 60)
scene.cameraFollowSprite(ginny)
let foodFactorLeft = 3
let foodFactorMiddle = 3
let foodFactorRight = 3
let happinessDegradeFactor = 1
let healthDegradeFactor = 1
let critterBeingCarried: Critter | null = null
let critters: Array<Critter> = [{
        name: 'CritterOne',
        sprite: sprites.create(assets.image`critterOne`, SpriteKind.Critter),
        location: [10,15],
        happiness: 90,
        health: 70
    }]
// Place all the critters on load
for (let critter of critters) {
    critter.sprite.setPosition(critter.location[0], critter.location[1])
}

controller.player1.onButtonEvent(ControllerButton.A, ControllerButtonEvent.Released, () => {
    console.log('Pressed')
    // Check if a creature is near, if so pick it up
    if (ginny.isHittingTile(CollisionDirection.Top)) {
        console.log('Hit tile top?')
    }
})

// Drop critters with B
controller.player1.onButtonEvent(ControllerButton.B, ControllerButtonEvent.Released, () => {
    if (critterBeingCarried) {
        critterBeingCarried.sprite.follow(null)
        critterBeingCarried.sprite.setVelocity(20, 0)
        critterBeingCarried = null
        console.log('Drop the critter')
    } else {
        // Check all the critters to see if we are overlapping them
        critters.forEach(critter => {
            if (ginny.overlapsWith(critter.sprite) && !critterBeingCarried) {
                console.log('Pick up the critter!')
                critterBeingCarried = critter
                critter.sprite.follow(ginny)
            }
        })
    }
})

// Loop over each critter and degrade health/happiness
forever(function ()  {
    const thePause = Math.randomRange(100,5000)
    pause(thePause)
    for (let critter2 of critters) {
        if (critter2.sprite.vx === 0 && critter2.sprite.vy === 0) {
            // Move the critter
            const randDirectionX = Math.randomRange(-20, 20)
            const randDirectionY = Math.randomRange(-20, 20)
            critter2.sprite.setVelocity(randDirectionX, randDirectionY)
        } else {
            // Stop any movement
            critter2.sprite.setVelocity(0, 0)
        }
        // Display the emoji if they are not healthy/happy
        if (critter2.health < 30) {
            critter2.sprite.sayText("h", 2000)
        } else if (critter2.happiness < 30) {
            critter2.sprite.sayText("f", 2000)
        }
    }
})
